<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Responsive Admin Dashboard Template">
<meta name="keywords" content="admin,dashboard">
<meta name="author" content="stacks">
<!-- The above 6 meta tags *must* come first in the head;any other head content must come *after* these tags --><!-- Title -->
<title>组长 - 任务管理</title>
{% load static %}
<!-- Styles -->
<link href="https://fonts.googleapis.com/css?family=Poppins:400,500,700,800&display=swap" rel="stylesheet">
<link href="/statics/assets_tech/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/statics/bootstrap/bootstrapValidator.css" rel="stylesheet">
<link href="/statics/assets_tech/plugins/font-awesome/css/all.min.css" rel="stylesheet">
  <link href="/statics/assets_tech/plugins/treejs/themes/default/style.css" rel="stylesheet">
<link href="/statics/assets_tech/plugins/perfectscroll/perfect-scrollbar.css" rel="stylesheet">
<!-- Theme Styles -->
<link href="/statics/assets_tech/css/main.min.css" rel="stylesheet">
<link href="/statics/assets_tech/css/custom.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="/statics/calender/css/bootstrap-year-calendar.min.css">
  <style type="text/css">
		#calendar{
			width: 100%;
			height: 100%;
			overflow: hidden;
		}
  </style>
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --><!-- WARNING:Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>
<div class='loader'>
  <div class='spinner-grow text-primary' role='status'> <span class='sr-only'>Loading...</span> </div>
</div>
<div class="page-container">
  <div class="page-header">
    <nav class="navbar navbar-expand-lg d-flex justify-content-between">
      <div class="" id="navbarNav">
        <ul class="navbar-nav" id="leftNav">
          <li class="nav-item"><a class="nav-link" id="sidebar-toggle" href="#"><i data-feather="arrow-left"></i></a></li>
          <li class="nav-item"><a class="nav-link" href="/stutask/">主页</a></li>
           <li class="nav-item"><a class="nav-link" href="/userset/">设置</a></li>
          <li class="nav-item"><a class="nav-link" href="/index/">切换账号</a></li>
        </ul>
      </div>
      <div class="logo"><a class="navbar-brand" href="index.html"></a></div>
      <div class="" id="headerNav">
        <ul class="navbar-nav">
          <li class="nav-item dropdown"><a class="nav-link search-dropdown" href="#" id="searchDropDown" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i data-feather="search"></i></a>
            <div class="dropdown-menu dropdown-menu-end dropdown-lg search-drop-menu" aria-labelledby="searchDropDown">
              <form>
                <input class="form-control" type="text" placeholder="Type something.." aria-label="Search">
              </form>
              <h6 class="dropdown-header">Recent Searches</h6>
              <a class="dropdown-item" href="#">charts</a><a class="dropdown-item" href="#">new orders</a><a class="dropdown-item" href="#">file manager</a><a class="dropdown-item" href="#">new users</a></div>
          </li>
          <li class="nav-item dropdown"><a class="nav-link notifications-dropdown" href="#" id="notificationsDropDown" role="button" data-bs-toggle="dropdown" aria-expanded="false">{{notice_list.0.notice_count}}</a>
            <div class="dropdown-menu dropdown-menu-end notif-drop-menu" aria-labelledby="notificationsDropDown">
              <h6 class="dropdown-header">通知</h6>
              {% if notice_list.0.notice_count != 0 %}
                {% for item in notice_list%}
              <a href="#">
              <div class="header-notif">
                <div class="notif-image"><span class="notification-badge bg-info text-white"><i class="fas fa-bullhorn"></i></span></div>
                <div class="notif-text">
                  <p class="bold-notif-text">来自:{{item.send_role}}{{item.send_name}}</p>
                </div>
                <div class="notif-text">
                  <h4 class="bold-notif-text"><code>{{item.notice_title}}</code></h4>
                </div>
                <div class="notif-text">
                  <h4 class="bold-notif-text">{{item.notice_content}}</h4>
                  <small>{{item.notice_time}}</small></div>
              </div>
              </a>
                {% endfor %}
              {% endif %}
            </div>
          </li>
          <li class="nav-item dropdown"><a class="nav-link profile-dropdown" href="#" id="profileDropDown" role="button" data-bs-toggle="dropdown" aria-expanded="false"><img src="/statics/assets_tech/images/avatars/profile-image.png" alt=""></a>
            <div class="dropdown-menu dropdown-menu-end profile-drop-menu" aria-labelledby="profileDropDown">
              <a class="dropdown-item" href="#"><i data-feather="user"></i>个人简介</a>
              <a class="dropdown-item" href="#"><i data-feather="inbox"></i>消息</a>
              <a class="dropdown-item" href="#"><i data-feather="edit"></i>活动<span class="badge rounded-pill bg-success">12</span></a>
              <a class="dropdown-item" href="#"><i data-feather="check-circle"></i>任务</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#"><i data-feather="settings"></i>设置</a><a class="dropdown-item" href="#"><i data-feather="unlock"></i>锁屏</a><a class="dropdown-item" href="#"><i data-feather="log-out"></i>登出</a></div>
          </li>
        </ul>
      </div>
    </nav>
  </div>
  <div class="page-sidebar">
    <ul class="list-unstyled accordion-menu">
      <li class="sidebar-title">Main </li>
      <li ><a href="/stutask/"><i data-feather="home"></i>主页</a></li>
      <li class="sidebar-title">Apps </li>
      <li class="active-page"><a href="/leader_taskmanage/"><i data-feather="clipboard"></i>任务管理</a></li>
      <li><a href="/sendfeedback/"><i data-feather="clipboard"></i>发送反馈</a></li>
       <li  ><a href="/replyfeedback/"><i data-feather="clipboard"></i>反馈回复</a></li>
      <li><a ><i data-feather="archive"></i>学习评价<i class="fas fa-chevron-right dropdown-icon"></i></a>
         <ul class="">
           <li><a href="/stu_eva/"><i class="far fa-circle"></i>学生自评</a></li>
           <li><a href="/group_eva/"><i class="far fa-circle"></i>小组评价</a></li>
           <li><a href="/diff_eva/"><i class="far fa-circle"></i>组间互评</a></li>
           <li><a href="/mem_eva/"><i class="far fa-circle"></i>成员互评</a></li>
        </ul>
      </li>
      <li><a href="/stu_pj_manage/?stu_num={{stu_info.0.num}}"><i data-feather="clipboard"></i>评价管理</a></li>
      <li><a href="/chat/{{stu_info.0.group_id}}"><i data-feather="clipboard"></i>讨论区</a></li>
      <li><a href="/calendar_check/"><i data-feather="calendar"></i>日历查看</a></li>
      <li><a href="/stumanage/"><i data-feather="users"></i>成员管理</a></li>
      <li><a href="file-manager.html"><i data-feather="message-circle"></i>文件管理</a></li>
    </ul>>
   </div>
  <div class="page-content">
    <div class="main-wrapper">

      <div class="row">
        <div class="col-sm-12 col-xl-4">
          <div class="card">
            <div class="card-body">
              <h3 class="card-title">任务树</h3>
              <p>展示成员与任务的关系</p>
              <div id="tree2" style="font-size:20px;">
                <ul>
                  {% for item in member_list%}
                  <li>{{item.group_role}}:{{item.name}}
                    <ul>
                      {% for i in task_lists %}
                      {% if i.num == item.num %}
                        {% if i.is_finish == True %}
                      <li>{{i.task_content}}<code>已完成</code> </li>
                        {% else %}
                        <li>{{i.task_content}}<code>未完成</code></li>
                        {% endif %}
                      {% endif %}
                      {% endfor%}
                    </ul>
                  </li>
                  {% endfor%}
                </ul>
              </div>
            </div>
          </div>
        </div>
         <div class="col-sm-12 col-xl-8">
          <div class="card">
            <div class="card-body">
              <h3 class="card-title">添加任务</h3>
              <p>添加学习任务</p>
             <form id="taskadd"  method="post" name="taskadd" class="row g-3 needs-validation" novalidate>
                       {% csrf_token %}
                      <div class="mb-3">
                      <label for="num" class="form-label">学号</label>
                      <select id="num" name="num" class="form-select" aria-label="Default select example">
                         {% for i in member_list%}
                          <option value="{{i.num}}">{{i.num}}</option>
                         {% endfor %}
                      </select>
                      </div>
                      <div class="mb-3">
                      <label for="name" class="form-label">姓名</label>
                      <input type="text" class="form-control" id="name" name="name" readonly="true" required>
                      </div>
                      <div class="mb-3">
                      <label for="role" class="form-label">职责</label>
                      <input type="text" class="form-control" id="role" name="role" readonly="true" required>
                      </div>
                      <div class="mb-3">
                      <label for="tasks_id" class="form-label">任务编号</label>
                      <input type="text" class="form-control" id="tasks_id" name="tasks_id"
                             value="{{ maxid }}"
                             readonly="true">
                      </div>
                      <div class="mb-3 form-group" class="input-group has-validation">
                      <label for="content" class="form-label">任务内容</label>
                      <input type="text" class="form-control" id="content" name="content"  required>
                        <div class="invalid-feedback">请填写任务内容 </div>
                      </div>
                      <div class="mb-3 form-group">
                      <label for="starttime" class="form-label">开始时间</label>
                      <input type="date" class="form-control" id="starttime" name="starttime" required>
                      </div>
                      <div class="mb-3 form-group">
                      <label for="endtime" class="form-label">结束时间</label>
                      <input type="date" class="form-control" id="endtime" name="endtime" required>
                      </div>
                      <div class="mb-3">
                      <label for="tasktype" class="form-label">任务类型</label>
                        <select id="tasktype" name="tasktype" class="form-select" aria-label="Default select example">
                         <option value="1">职责任务</option>
                         <option value="2">学习任务</option>
                      </select>
                      </div>
                      <div class="mb-3">
                      <label for="subid" class="form-label">前置任务编号</label>
                        <select id="subid" name="subid" class="form-select" aria-label="Default select example">
                         {% for i in task_ids%}
                          <option value="{{i.task_id}}">{{i.task_id}}</option>
                          {% endfor %}
                           <option value="0">0</option>
                      </select>
                      </div>

                    <div class="modal-footer">
                      <button class="btn btn-primary" onclick="addtaskinfo()" type="button">提交表单</button>
                    </div>

                    </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">任务展示</h4>
              <div>
               {% csrf_token %}
                      <table id="zero-conf" class="display" style="width:100%" id= "group{{ group.group_id }}"class="table">
                          <thead>
                             <tr>
                                <th>学号</th>
                                <th>姓名</th>
                                <th>任务编号</th>
                                <th>任务内容</th>
                                <th>开始时间</th>
                                <th>结束时间</th>
                                <th>任务类型</th>
                                <th>是否完成</th>
                                <th>是否超时</th>
                                <th>前置任务编号</th>
                                <th>##</th>
                              </tr>
                          </thead>
                         <tbody id="stuinfo{{group.group_id}}" name="stuinfo{{group.group_id}}">
                         {%  for row in task_lists %}
                          <tr>
                          <td >{{ row.num }}</td>
                          <td >{{ row.name }}</td>
                          <td>{{ row.task_id }}</td>
                          <td>{{ row.task_content }}</td>
                          <td value="{{ row.start_time }}">{{ row.start_time }}</td>
                            <td value="{{ row.end_time }}">{{ row.end_time }}</td>
                            {% if row.task_type == "1" %}
                            <td value="{{ row.task_type }}">职责任务</td>
                            {% else %}
                            <td value="{{ row.task_type }}">学习任务</td>
                             {% endif %}
                            {% if row.is_finish == False  %}
                            <td value="{{ row.is_finish }}">未完成</td>
                            {% else %}
                            <td value="{{ row.is_finish }}">已完成</td>
                             {% endif %}
                            {% if row.is_overtime == True %}
                            <td value="{{ row.is_overtime }}">已超时</td>
                            {% else %}
                            <td value="{{ row.is_overtime }}">未超时</td>
                             {% endif %}

                            <td>{{ row.sub_id }}</td>
                          <td class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" onclick="changetaskinfo()">
                             修改
                         </td>
                          </tr>
                      {% endfor %}
                     </tbody>
                      </table>
              </div>
                          <!-- Modal -->
              <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="staticBackdropLabel">修改任务</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="defaultForm"  method="post" name="taskinit">
                    <div class="modal-body">
                       {% csrf_token %}
                      <div class="mb-3">
                      <label for="stu_num" class="form-label">学号</label>
                      <input type="text" class="form-control" id="stu_num" name="stu_num" readonly="true">
                      </div>
                      <div class="mb-3">
                      <label for="stu_num" class="form-label">姓名</label>
                      <input type="text" class="form-control" id="stu_name" name="stu_name" readonly="true">
                      </div>
                      <div class="mb-3">
                      <label for="task_id" class="form-label">任务编号</label>
                      <input type="text" class="form-control" id="task_id" name="task_id" readonly="true">
                      </div>
                      <div class="mb-3">
                      <label for="task_content" class="form-label">任务内容</label>
                      <input type="text" class="form-control" id="task_content" name="task_content" aria-describedby="emailHelp">
                      </div>
                      <div class="mb-3">
                      <label for="start_time" class="form-label">开始时间</label>
                      <input type="date" class="form-control" id="start_time" name="start_time" placeholder="Min date">
                      </div>
                      <div class="mb-3">
                      <label for="end_time" class="form-label">结束时间</label>
                      <input type="date" class="form-control" id="end_time" name="end_time" aria-describedby="emailHelp">
                      </div>
                      <div class="mb-3">
                      <label for="task_type" class="form-label">任务类型</label>
                        <select id="task_type" name="task_type" class="form-select" aria-label="Default select example">
                         <option value="1">职责任务</option>
                         <option value="2">学习任务</option>
                      </select>
                      </div>
                      <div class="mb-3">
                      <label for="sub_id" class="form-label">前置任务编号</label>
                        <select id="sub_id" name="sub_id" class="form-select" aria-label="Default select example">
                         {% for i in task_ids%}
                          <option value="{{i.task_id}}">{{i.task_id}}</option>
                          {% endfor %}
                           <option value="0">0</option>
                      </select>
                      </div>

                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                      <button type="button" onclick="submitinfo()" class="btn btn-primary">提交修改</button>
                    </div>
                    </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


    </div>
  </div>
</div>
<!-- Javascripts --> 
<script src="/statics/assets_tech/plugins/jquery/jquery-3.4.1.min.js"></script>
<script src="https://unpkg.com/@popperjs/core@2"></script> 
<script src="/statics/assets_tech/plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="/statics/bootstrap/bootstrapValidator.js"></script>
<script src="https://unpkg.com/feather-icons"></script> 
<script src="/statics/assets_tech/plugins/perfectscroll/perfect-scrollbar.min.js"></script>
<script src="/statics/assets_tech/plugins/DataTables/datatables.min.js"></script>
<script src="/statics/assets_tech/js/main.min.js"></script>
<script src="/statics/assets_tech/js/pages/datatables.js"></script>
<script src="/statics/techinit/task_manage.js"></script>
<script src="/statics/assets_tech/js/pages/tree.js"></script>
<script src="/statics/assets_tech/plugins/treejs/jstree.min.js"></script>
<!-- calender-->
<!-- <script src="/statics/calender/js/jquery-2.1.1.min.js"></script>-->
	<script type="text/javascript" src="/statics/calender/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/statics/calender/js/bootstrap-datepicker.min.js"></script>
	<script src="/statics/calender/js/bootstrap-datepicker.fr.min.js"></script>
	<script type="text/javascript" src="/statics/calender/js/bootstrap-year-calendar.min.js"></script>
	<script src="/statics/calender/js/bootstrap-year-calendar.fr.min.js" charset="UTF-8"></script>
	<script type="text/javascript" src="/statics/calender/js/bootstrap-popover.js"></script>
	<script type="text/javascript" class="publish">
      $(function() {
          $(function() {
          $('#calendar').calendar({
              dataSource: [
                  {
                      startDate: new Date(new Date().getFullYear(), 1, 4),
                      endDate: new Date(new Date().getFullYear(), 1, 15)
                  },
                  {
                      startDate: new Date(new Date().getFullYear(), 3, 5),
                      endDate: new Date(new Date().getFullYear(), 5, 15)
                  }
              ]
          });
          });

      });
</script>
</body>
</html>